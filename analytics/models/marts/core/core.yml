version: 2

models:
  - name: dim_customer
    description: "Customer dimension (1 row per customer). Descriptive attributes only."
    columns:
      - name: customer_id
        tests:
          - not_null
          - unique

  - name: dim_account
    description: "Account dimension (1 row per account). Product descriptors."
    columns:
      - name: account_id
        tests:
          - not_null
          - unique

  - name: fct_customer_account_snapshot
    description: "Snapshot fact at grain customer_id + account_id. Raw measures only."
    tests:
      - dbt_utils.unique_combination_of_columns:
          arguments:
            combination_of_columns:
              - customer_id
              - account_id

    columns:
      - name: customer_id
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('dim_customer')
                field: customer_id

      - name: account_id
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('dim_account')
                field: account_id
